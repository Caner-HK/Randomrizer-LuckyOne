<!doctype html>
<!--
 ____                                        __  __  __  __     
/\  _`\                                     /\ \/\ \/\ \/\ \    
\ \ \/\_\     __      ___      __   _ __    \ \ \_\ \ \ \/'/'   
 \ \ \/_/_  /'__`\  /' _ `\  /'__`\/\`'__\   \ \  _  \ \ , <    
  \ \ \L\ \/\ \L\.\_/\ \/\ \/\  __/\ \ \/     \ \ \ \ \ \ \\`\  
   \ \____/\ \__/.\_\ \_\ \_\ \____\\ \_\      \ \_\ \_\ \_\ \_\
    \/___/  \/__/\/_/\/_/\/_/\/____/ \/_/       \/_/\/_/\/_/\/_/

    COPYRIGHT Â© Caner HK 2025
    https://github.com/Caner-HK/Randomrizer-LuckyOne
-->
<html lang="zh-HK">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" />
  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <link rel="stylesheet" href="https://resource.caner.hk/get/mdui/css/mdui.min.css" />
  <link href="https://resource.caner.hk/get/josefin_sans/get.css" rel="stylesheet">
  <title>éš¨æ©Ÿé¸æ“‡æ´»å‹•åƒèˆ‡è€…</title>
  <style>
    body {
      font-family: 'Josefin Sans', sans-serif;
    }
    .rounded {
      border-radius: 6px;
    }
    .custom-container {
      padding-left: 15px;
      padding-right: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 93vh;
    }
    .mdui-card {
      width: 100%;
      max-width: 700px;
    }
    .action-container {
      display: flex;
      align-items: center;
    }
    .full-container {
      margin: 0px;
    }
    
    #excludeCheckboxes {
      padding-left: 24px;
      max-height: 300px;
      overflow-y: auto;
      padding-top: 10px;
    }
  </style>
</head>

<body class="mdui-theme-primary-blue mdui-theme-accent-amber mdui-theme-layout-auto">
  <div class="custom-container">
    <div class="mdui-card rounded">

      <!-- Loading Progress -->
      <div id="loadingProgress" class="mdui-progress" style="display: none;">
        <div class="mdui-progress-indeterminate"></div>
      </div>

      <!-- Normal Progress -->
      <div id="normalProgress" class="mdui-progress">
        <div class="mdui-progress-determinate" style="width: 100%;"></div>
      </div>

      <!-- å¡ç‰‡æ¨™é¡Œ -->
      <div class="mdui-card-primary">
        <div class="mdui-card-primary-title mdui-text-color-theme-700">
          éš¨æ©Ÿé¸æ“‡ <span id="number">5 äºº</span> ä½œç‚ºå¹¸é‹å…’
        </div>
        <div class="mdui-card-primary-subtitle">
          éš¨æ©Ÿé¸æ“‡å¹¸é‹å…’åƒåŠ æ´»å‹• ğŸ˜
        </div>
      </div>

      <!-- å¡ç‰‡å…§å®¹ -->
      <div class="mdui-card-content" style="margin-top: -16px;">

        <!-- è¨­å®šç¸½äººæ•¸ï¼ˆé è¨­é¡¯ç¤ºâ€œé»æ“Šä»¥è¨­å®šç¸½äººæ•¸â€ï¼‰-->
        <div class="mdui-chip" style="margin-bottom: 8px;" mdui-dialog="{target: '#setCount'}">
          <span class="mdui-chip-icon mdui-color-blue">
            <i class="mdui-icon material-icons">people</i>
          </span>
          <span class="mdui-chip-title" id="chipTotalPeople">é»æ“Šä»¥è¨­å®šç¸½äººæ•¸</span>
        </div>
        <br>

        <!-- è¨­å®šæ’é™¤é …ï¼ˆé è¨­é¡¯ç¤ºâ€œé»æ“Šä»¥è¨­å®šæ’é™¤é …â€ï¼‰-->
        <div class="mdui-chip" style="margin-bottom: 8px;" mdui-dialog="{target: '#setExclude'}">
          <span class="mdui-chip-icon mdui-color-blue">
            <i class="mdui-icon material-icons">people_outlined</i>
          </span>
          <span class="mdui-chip-title" id="chipExcluded">é»æ“Šä»¥è¨­å®šæ’é™¤é …</span>
        </div>
        <br>

        <!-- è¨­å®šæŠ½å–äººæ•¸ï¼šèœå–®é …æ ¹æ“šå‰©é¤˜äººæ•¸åˆ¤æ–·å¯ç”¨æ€§ -->
        <div class="mdui-chip" mdui-menu="{target: '#example-menu'}">
          <span class="mdui-chip-icon mdui-color-amber">
            <i class="mdui-icon material-icons">games</i>
          </span>
          <span class="mdui-chip-title" id="chipContent">é¸æ“‡æŠ½å–çš„äººæ•¸ï¼š5 äºº</span>
        </div>

        <ul class="mdui-menu rounded" id="example-menu">
          <li class="mdui-menu-item" id="menuItem1" onclick="updateChip(1)">
            <a href="javascript:;" class="mdui-ripple">1 äºº</a>
          </li>
          <li class="mdui-menu-item" id="menuItem5" onclick="updateChip(5)">
            <a href="javascript:;" class="mdui-ripple">5 äºº</a>
          </li>
          <li class="mdui-menu-item" id="menuItem10" onclick="updateChip(10)">
            <a href="javascript:;" class="mdui-ripple">10 äºº</a>
          </li>
        </ul>

        <!-- é¡¯ç¤ºæŠ½å–çµæœ -->
        <div class="mdui-typo-headline" style="margin-top: 16px;">æœ¬æ¬¡å¹¸é‹å…’æ˜¯ï¼š</div>
        <br>
        <strong class="mdui-typo-display-2">
          <span id="luckyone" style="line-height: 1;">? ? ? ? ?</span>
        </strong>
      </div>

      <!-- å¡ç‰‡æŒ‰éˆ•å€ -->
      <div class="mdui-card-actions action-container">
        <button id="startButton" class="mdui-btn rounded mdui-btn-raised mdui-ripple mdui-color-theme-accent action-item"
          onclick="getRandomPeople()" disabled>
          <span style="position: relative; top: 1px;">é–‹å§‹</span>
          <i class="mdui-icon material-icons">arrow_forward</i>
        </button>

        <div id="spinnerContainer" class="action-item" style="display:none; margin-left: 24px; margin-right:24px;">
          <div class="mdui-spinner mdui-spinner-colorful"></div>
        </div>

        <button id="saveButton" class="mdui-btn rounded mdui-btn-raised mdui-ripple mdui-color-theme-accent action-item"
          onclick="saveResult()" style="display:none;">
          <span style="position: relative; top: 1px;">ä¸‹è¼‰çµæœ</span>
          <i class="mdui-icon material-icons">file_download</i>
        </button>
      </div>
    </div>
  </div>

  <!-- å°è©±æ¡†ï¼šè¨­å®šç¸½äººæ•¸ -->
  <div class="mdui-dialog" id="setCount">
    <div class="mdui-dialog-title">è¨­å®šæŠ½å–ç¸½äººæ•¸</div>
    <div class="mdui-dialog-content">
      è«‹è¼¸å…¥äººæ•¸ï¼ŒæŠ½å–çš„æ•¸å­—å°‡ç‚º 1 è‡³æ‚¨è¨­å®šçš„æ•¸å­—
      <div class="mdui-textfield mdui-textfield-floating-label">
        <label class="mdui-textfield-label">è¼¸å…¥æ•¸å­—</label>
        <input class="mdui-textfield-input" id="inputCount" type="number" min="1" />
      </div>
    </div>
    <div class="mdui-dialog-actions">
      <button class="mdui-btn mdui-ripple" mdui-dialog-close>å–æ¶ˆ</button>
      <button class="mdui-btn mdui-ripple" mdui-dialog-confirm onclick="setTotalCount()">ç¢ºå®š</button>
    </div>
  </div>

  <!-- å°è©±æ¡†ï¼šè¨­å®šæ’é™¤é … -->
  <div class="mdui-dialog" id="setExclude">
    <div class="mdui-dialog-title">è¨­å®šæ’é™¤åˆ—è¡¨</div>
    <div class="full-container">
      <div class="mdui-dialog-content" style="margin-top: -25px; margin-bottom: -16px;">
        æ‰€å‹¾é¸çš„æ•¸å­—å°‡è¢«æ’é™¤åœ¨æŠ½å–åˆ—è¡¨å¤–ï¼Œå‰©é¤˜äººæ•¸å°‘æ–¼æŠ½å–äººæ•¸æ™‚å°‡ç„¡æ³•æŠ½å–
      </div>
      <div id="excludeCheckboxes">
        <!-- å‹•æ…‹æ·»åŠ å¾©é¸æ¡† -->
      </div>
    </div>
    <div class="mdui-dialog-actions">
      <button class="mdui-btn mdui-ripple" mdui-dialog-close>å–æ¶ˆ</button>
      <button class="mdui-btn mdui-ripple" mdui-dialog-confirm onclick="setExcludeList()">ç¢ºå®š</button>
    </div>
  </div>

  <script src="https://resource.caner.hk/get/mdui/js/mdui.min.js"></script>
  <script>
    let totalPeopleCount = 0;    // ç¸½äººæ•¸
    let excludedNumbers = [];    // æ’é™¤åˆ—è¡¨ï¼ˆç”±ç”¨æˆ¶é€šéå°è©±æ¡†é¸æ“‡ï¼‰
    let selectedNumber = 5;      // ç•¶å‰é¸å®šçš„â€œæŠ½å¹¾å€‹äººâ€ï¼Œé è¨­ 5 äºº

    document.addEventListener('DOMContentLoaded', function () {
      mdui.mutation();
    });

    /**
     * å‰©é¤˜äººæ•¸ = totalPeopleCount - excludedNumbers.length
     */
    function getLeftoverCount() {
      return totalPeopleCount - excludedNumbers.length;
    }

    /**
     * è¨­å®šç¸½äººæ•¸
     */
    function setTotalCount() {
      const inputVal = document.getElementById('inputCount').value;
      if (!inputVal || inputVal <= 0) {
        return;
      }
      totalPeopleCount = parseInt(inputVal, 10);

      // æ›´æ–°é¡¯ç¤º
      document.getElementById('chipTotalPeople').textContent = `æ•¸å­—ç¯„åœï¼š1 - ${totalPeopleCount}`;

      // ç”Ÿæˆâ€œæ’é™¤åˆ—è¡¨â€å°è©±æ¡†çš„å¾©é¸æ¡†
      generateExcludeCheckboxes();

      // é‡ç½®æ’é™¤é …
      excludedNumbers = [];
      document.getElementById('chipExcluded').textContent = 'é»æ“Šä»¥è¨­ç½®æ’é™¤é …';

      // èœå–®é …å¯ç”¨æ€§ï¼šæ ¹æ“šâ€œå‰©é¤˜äººæ•¸â€ä¾†åˆ¤æ–·
      toggleMenuItems(getLeftoverCount());

      // æª¢æŸ¥æ˜¯å¦å¯ä»¥æŠ½å–
      checkIfStartButtonEnabled();

      // é—œé–‰å°è©±æ¡†
      const dialog = document.getElementById('setCount');
      new mdui.Dialog(dialog).close();
    }

    /**
     * å‹•æ…‹ç”Ÿæˆå¾©é¸æ¡†ï¼ˆ1 ~ totalPeopleCountï¼‰
     */
    function generateExcludeCheckboxes() {
      const container = document.getElementById('excludeCheckboxes');
      container.innerHTML = ''; // å…ˆæ¸…ç©º

      for (let i = 1; i <= totalPeopleCount; i++) {
        // å‰µå»º label
        const label = document.createElement('label');
        label.className = 'mdui-checkbox';
        // å‰µå»º input
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.value = i;   // ç”¨æ•¸å­—æ¨™è­˜è‡ªå·±
        // å‰µå»º i
        const iTag = document.createElement('i');
        iTag.className = 'mdui-checkbox-icon';

        // label çš„æ–‡æœ¬ç¯€é»
        const textNode = document.createTextNode(` æ•¸å­— ${i}`);

        // æ‹¼è£
        label.appendChild(input);
        label.appendChild(iTag);
        label.appendChild(textNode);

        // åŠ å…¥å®¹å™¨
        container.appendChild(label);
        container.appendChild(document.createElement('br'));
      }
    }

    /**
     * ç”¨æˆ¶é»æ“Šâ€œç¢ºå®šâ€æ™‚ï¼Œè®€å–å‹¾é¸çš„æ•¸å­—ä¸¦æ›´æ–° excludedNumbers
     */
    function setExcludeList() {
      const container = document.getElementById('excludeCheckboxes');
      const checkboxes = container.querySelectorAll('input[type="checkbox"]');
      const newExcludes = [];
    
      checkboxes.forEach(chk => {
        if (chk.checked) {
          newExcludes.push(parseInt(chk.value, 10));
        }
      });
    
      excludedNumbers = newExcludes;
      
      // æ›´æ–° Chip é¡¯ç¤º
      if (excludedNumbers.length > 0) {
        // æ’é™¤é …æ ¼å¼ï¼šå·²æ’é™¤ 1,3,6 å…± 3 é …
        document.getElementById('chipExcluded').textContent = `å·²æ’é™¤ ${excludedNumbers.join(', ')} å…± ${excludedNumbers.length} é …`;
      } else {
        document.getElementById('chipExcluded').textContent = 'é»æ“Šä»¥è¨­ç½®æ’é™¤é …';
      }
    
      // æ›´æ–°èœå–®é …å¯ç”¨æ€§ã€æª¢æŸ¥å¯å¦æŠ½å–
      toggleMenuItems(getLeftoverCount());
      checkIfStartButtonEnabled();
    }

    /**
     * æ ¹æ“šå‰©é¤˜äººæ•¸ä¾†ç¦ç”¨æˆ–å•Ÿç”¨æŠ½å–äººæ•¸ > å‰©é¤˜äººæ•¸ çš„èœå–®é …
     * @param {*} effectiveCount å‰©é¤˜äººæ•¸(ç¸½äººæ•¸-æ’é™¤äººæ•¸)
     */
    function toggleMenuItems(effectiveCount) {
      const menuItem1 = document.getElementById('menuItem1');
      const menuItem5 = document.getElementById('menuItem5');
      const menuItem10 = document.getElementById('menuItem10');

      // å…ˆå…¨éƒ¨ç§»é™¤ç¦ç”¨
      [menuItem1, menuItem5, menuItem10].forEach(item => item.classList.remove('mdui-disabled'));

      // å¦‚æœ effectiveCount < 1ï¼Œéƒ½ç¦ç”¨
      if (effectiveCount < 1) {
        [menuItem1, menuItem5, menuItem10].forEach(item => item.classList.add('mdui-disabled'));
        return;
      }

      // å¦‚æœ < 5ï¼Œäººï¼Œå‰‡ç¦ç”¨5å’Œ10
      if (effectiveCount < 5) {
        menuItem5.classList.add('mdui-disabled');
        menuItem10.classList.add('mdui-disabled');
      } 
      // å¦‚æœ < 10 äººï¼Œå‰‡ç¦ç”¨10
      else if (effectiveCount < 10) {
        menuItem10.classList.add('mdui-disabled');
      }
    }

    /**
     * æ›´æ–°â€œæŠ½å¹¾å€‹äººâ€è¨­ç½®
     */
    function updateChip(number) {
      const menuItem = document.getElementById(`menuItem${number}`);
      if (menuItem.classList.contains('mdui-disabled')) {
        // å¦‚æœè¢«ç¦ç”¨ï¼Œçµ¦å‡ºæç¤º
        mdui.snackbar({
          message: `å‰©é¤˜äººæ•¸ä¸è¶³ä»¥æŠ½ ${number} äºº`,
          position: 'left-bottom'
        });
        return;
      }

      selectedNumber = number;
      document.getElementById('chipContent').textContent = `é¸æ“‡æŠ½å–çš„äººæ•¸ï¼š${number} äºº`;
      document.getElementById('number').textContent = `${number} äºº`;

      // æª¢æŸ¥æ˜¯å¦å¯ä»¥é–‹å§‹
      checkIfStartButtonEnabled();
    }

    /**
     * æª¢æŸ¥â€œé–‹å§‹â€æŒ‰éˆ•æ˜¯å¦å¯ç”¨ï¼šå‰©é¤˜äººæ•¸ >= selectedNumber
     */
    function checkIfStartButtonEnabled() {
      // å¦‚æœé‚„æ²’è¨­å®š totalPeopleCountï¼Œæˆ–è€… totalPeopleCount=0ï¼Œç›´æ¥ç¦ç”¨
      if (totalPeopleCount <= 0) {
        document.getElementById('startButton').disabled = true;
        return;
      }

      const leftover = getLeftoverCount();
      // å¦‚æœå‰©é¤˜äººæ•¸ >= é¸å®šæŠ½å–äººæ•¸ => å•Ÿç”¨ï¼Œå¦å‰‡ç¦ç”¨
      if (leftover >= selectedNumber) {
        document.getElementById('startButton').disabled = false;
      } else {
        document.getElementById('startButton').disabled = true;
      }
    }

    /**
     * é–‹å§‹æŠ½å–
     */
    function getRandomPeople() {
      // éš±è—é–‹å§‹æŒ‰éˆ•ï¼Œé¡¯ç¤º spinner
      document.getElementById('startButton').style.display = 'none';
      document.getElementById('spinnerContainer').style.display = 'block';

      // éš±è— normalProgressï¼Œé¡¯ç¤º loadingProgress
      document.getElementById('normalProgress').style.display = 'none';
      document.getElementById('loadingProgress').style.display = 'block';

      // å‹•æ…‹æ›´æ–°æ•¸å­—ï¼šæ¯100æ¯«ç§’éš¨æ©Ÿæ›´æ–°
      const intervalId = setInterval(() => {
        const luckyOneElement = document.getElementById('luckyone');
        let randomNumbers = [];
        for (let i = 0; i < selectedNumber; i++) {
          randomNumbers.push(Math.floor(Math.random() * totalPeopleCount) + 1);
        }
        luckyOneElement.textContent = randomNumbers.join(', ');
      }, 100);

      // 3ç§’å¾Œåœæ­¢é–ƒçˆï¼Œä¸¦é¡¯ç¤ºæœ€çµ‚çµæœ
      setTimeout(() => {
        clearInterval(intervalId);

        // å¯æŠ½å–çš„æ•¸çµ„ï¼šå‰”é™¤æ’é™¤é …
        let peopleArray = Array.from({ length: totalPeopleCount }, (_, i) => i + 1)
          .filter(num => !excludedNumbers.includes(num));

        let leftover = peopleArray.length; // çœŸæ­£å‰©é¤˜å¯æŠ½çš„äººæ•¸
        let luckyOnes = [];

        for (let i = 0; i < selectedNumber; i++) {
          if (peopleArray.length === 0) break; // æ²’äººå¯æŠ½å‰‡è·³å‡º
          const randomIndex = Math.floor(Math.random() * peopleArray.length);
          luckyOnes.push(peopleArray.splice(randomIndex, 1)[0]);
        }

        // é¡¯ç¤ºæœ€çµ‚çµæœ
        document.getElementById('luckyone').textContent = luckyOnes.join(', ');

        // UI é‚„åŸ
        document.getElementById('spinnerContainer').style.display = 'none';
        document.getElementById('loadingProgress').style.display = 'none';
        document.getElementById('normalProgress').style.display = 'block';

        const startButton = document.getElementById('startButton');
        startButton.style.display = 'block';
        // æ”¹æˆâ€œå†æ¬¡æŠ½å–â€ç‹€æ…‹
        startButton.innerHTML = '<span style="position: relative; top: 2px;">å†æ¬¡æŠ½å–</span> <i class="mdui-icon material-icons">refresh</i>';
        document.getElementById('saveButton').style.display = 'block'; // é¡¯ç¤ºä¿å­˜æŒ‰éˆ•
      }, 3000);
    }

    /**
     * ä¸‹è¼‰æŠ½å–çµæœåˆ° HTML æª”æ¡ˆ
     */
    function saveResult() {
      const luckyNumbers = document.getElementById('luckyone').textContent;
      const currentDate = new Date();
      const dateString = currentDate.toLocaleDateString('zh-HK'); // æ—¥æœŸ
      const timeString = currentDate.toLocaleTimeString('zh-HK', { hour12: false }); // æ™‚é–“

      const htmlContent = `
        <!DOCTYPE html>
        <html lang="zh-HK">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" />
          <title>æœ¬æ¬¡å¹¸é‹å…’</title>
        </head>
        <body>
          <h1>å¹¸é‹å…’åºè™Ÿ:<strong> ${luckyNumbers}</strong></h1>
          <p>æŠ½å–æ—¥æœŸ: ${dateString}</p>
          <p>æŠ½å–æ™‚é–“: ${timeString}</p>
          <h1>å¤ªå¹¸é‹äº†ï¼ä½ è¢«æŠ½ä¸­äº† ğŸ˜ğŸ˜ğŸ˜</h1>
        </body>
        </html>`;

      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'æŠ½å–çµæœ.html';
      a.click();
    }
  </script>
</body>
</html>